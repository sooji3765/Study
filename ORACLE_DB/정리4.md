
# 08 : 여러 테이블을 하나의 테이블처럼 사용하는 조인

### 08-1 : 조인

조인은 두 개 이사으이 테이블을 연결하여 하나의 테이블 처럼 출력할때 사용

실습 8-1 
~~~sql
SELECT *
FROM EMP, DEPT
ORDER BY EMPNO;
~~~

실습 8-2 : JOIN 하는 테이블의 조건 부여
~~~sql
SELECT *
FROM EMP, DEPT
WHERE EMP.DEPTNO= DEPT.DEPTNO
ORDER BY EMPNO;
~~~

> 테이블의 별칭 설정

실습 8-3
~~~sql
SELECT *
FROM EMP E,DEPT D
WHERE E.DEPTNO = D.DEPTNO;
~~~

복습
~~~sql
SELECT E.EMPNO, D.DEPTNO
FROM EMP E, DEPT D
WHERE E.DEPTNO= D.DEPTNO;
~~~

### 08-2 : 조인 종류

> 등가조인=내부조인=단순조인 
> 테이블 연결한 후 출력 행을 각 테이블의 특정 열에 일치한 데이터를 기준으로 선정

실습 8-6
~~~sql
SELECT E.EMPNO, E.ENAME, E.SAL, D.DEPTNO, D.DNAME
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO
AND SAL > = 1000;
~~~

복습
~~~sql
SELECT E.EMPNO, E.ENAME, E.SAL, D.DEPTNO, D.DNAME
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO
AND SAL <= 2500
AND EMPNO <=9999;
~~~

> 비등가 조인 : 등가 조인 방식 외

실습 8-7 : 급여 범위를 지정하는 조건식
~~~sql
SELECT *
FROM EMP E, SALGRADE S
WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL;
~~~

> 자체 조인

실습 8-8 : 같은 테이블 두번 사용하여 조인
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1, EMP E2
WHERE E1.MGR = E2.EMPNO;
~~~

> 외부조인 : 조인 기준 열의 어느 한쪽이 null 이어도 강제로 출력하는 방식

왼쪽 외부 조인
실습 8-9
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1, EMP E2
WHERE E1.MGR = E2.EMPNO(+);
~~~

오른쪽 외부 조인
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1, EMP E2
WHERE E1.MGR(+) = E2.EMPNO;
~~~

### 08-3 : SQL-99 표준 문법으로 배우는 조인

> NATURAL JOIN = 등가조인
두 테이블의 이름과 자료형이 같은 열을 찾아 그 열을 기준으로 등가조인

실습 8-11
~~~sql
SELECT E.ENAME, E.EMPNO, DEPTNO, D.DNAME 
FROM EMP E NATURAL JOIN DEPT D;
~~~

> JOIN ~ USING :등가조인 키워드

실습 8-12
~~~sql
SELECT E.ENAME, E.EMPNO, DEPTNO, D.DNAME 
FROM EMP E JOIN DEPT D USING (DEPTNO);
~~~

> JOIN ~ ON :등가조인 WHERE 절의 조인 조건을 ON에 명시

실습 8-12
~~~sql
SELECT E.ENAME, E.EMPNO, E.DEPTNO, D.DNAME 
FROM EMP E JOIN DEPT D ON (E.DEPTNO= D.DEPTNO);
~~~

> OUTER JOIN : 외부조인

실습 8-14 왼쪽 조인
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1 LEFT OUTER JOIN EMP E2 ON (E1.MGR =E2.EMPNO);    
~~~

실습 8-15 왼쪽 조인
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1 RIGHT OUTER JOIN EMP E2 ON (E1.MGR =E2.EMPNO);    
~~~

> 전체 외부 조인

실습 8-16
~~~sql
SELECT E1.EMPNO, E1.ENAME, E1.MGR,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM EMP E1 FULL OUTER JOIN EMP E2 ON (E1.MGR =E2.EMPNO)
ORDER BY E1.EMPNO;    
~~~

복습
~~~sql
SELECT E.EMPNO,E.ENAME, E.JOB,E.HIREDATE,E.SAL,E.COMM,
    DEPTNO, D.DNAME,D.LOC
FROM EMP E JOIN DEPT D USING (DEPTNO)
WHERE E.SAL >=3000
AND E.MGR IS NOT NULL
ORDER BY DEPTNO, E.ENAME;
~~~

## 문제

> Q1

SQL-99 방식

~~~sql
SELECT DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.SAL
FROM EMP E JOIN DEPT D USING (DEPTNO)
WHERE E.SAL >2000
ORDER BY DEPTNO;
~~~

SQL-99 이전 방식
~~~sql
SELECT E.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.SAL
FROM EMP E ,DEPT D
WHERE E.SAL >2000 AND E.DEPTNO=D.DEPTNO
ORDER BY DEPTNO;
~~~

> Q2

표준
~~~sql
SELECT D.DEPTNO, D.DNAME, TRUNC(AVG(E.SAL),0), MAX(E.SAL), MIN(E.SAL),COUNT(*)
FROM EMP E ,DEPT D
WHERE E.DEPTNO = D.DEPTNO
GROUP BY D.DEPTNO,D.DNAME;
~~~

표준 아닌
~~~sql
SELECT DEPTNO, D.DNAME, TRUNC(AVG(E.SAL),0), MAX(E.SAL), MIN(E.SAL),COUNT(*)
FROM EMP E JOIN DEPT D USING (DEPTNO)
GROUP BY DEPTNO,D.DNAME;
~~~

> Q3

~~~sql
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.JOB, E.SAL
FROM DEPT D LEFT OUTER JOIN EMP E ON E.DEPTNO = D.DEPTNO
ORDER BY D.DEPTNO;
~~~

~~~sql
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.JOB, E.SAL
FROM DEPT D , EMP E 
WHERE E.DEPTNO(+) = D.DEPTNO
ORDER BY D.DEPTNO;
~~~

> Q4

~~~sql
SELECT D1.DEPTNO, 
    D1.DNAME, 
    E1.EMPNO, 
    E1.ENAME, 
    E1.MGR, 
    E1.SAL,
    D2.DEPTNO AS DEPTNO_1,
    S.LOSAL AS LOSAL,
    S.HISAL AS HISAL,
    S.GRADE AS GRAGE,
    E2.EMPNO AS MGR_EMPNO,
    E2.ENAME AS MGR_ENAME
FROM DEPT D1 LEFT OUTER JOIN EMP E1 ON E1.DEPTNO = D1.DEPTNO
JOIN SALGRADE S ON E1.SAL BETWEEN S.LOSAL AND S.HISAL
JOIN EMP E2 ON E1.MGR = E2.EMPNO
JOIN DEPT D2 ON D2.DEPTNO = E2.DEPTNO
ORDER BY D1.DEPTNO;
~~~